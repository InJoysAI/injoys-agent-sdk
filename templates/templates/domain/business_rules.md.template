# 业务规则模板 (Business Rules Template)

> **Metadata**
> - **Source**: `{{PRD 文档路径}}`
> - **Generated At**: `{{生成时间 YYYY-MM-DD HH:mm}}`
> - **Generator**: `Context-Agent v1.0`

---

## 命名约定

- **BR-XXX**: 业务规则编号
- **MUST**: 必须遵守（违反将导致系统错误或业务风险）
- **SHOULD**: 建议遵守（违反影响用户体验）
- **MAY**: 可选（增强功能）

---

## {{业务领域 1，如：用户管理}}

### BR-001: {{规则名称，如：手机号格式校验}}
- **强制等级**: MUST
- **规则**:
  - {{规则描述 1，如：仅允许输入数字}}
  - {{规则描述 2，如：长度限制 11 位}}
- **校验正则**: `{{e.g. ^1[3-9]\d{9}$}}`
- **验收点**: {{如：输入错误时输入框变红，显示 Toast 提示}}

### BR-002: {{规则名称，如：验证码获取限制}}
- **强制等级**: SHOULD
- **规则**:
  ```
  IF 同一 IP 24小时内请求 > 5 次 THEN 弹出图形验证码
  ELSE IF 同一 IP 24小时内请求 > 10 次 THEN 封禁 IP 24小时
  ```
- **验收点**: {{如：超限时显示 Captcha}}

---

## {{业务领域 2，如：支付与订阅}}

### BR-010: {{规则名称，如：Token 过期处理}}
- **强制等级**: MUST
- **规则**:
  - Access Token 有效期：{{e.g. 2小时}}
  - Refresh Token 有效期：{{e.g. 7天}}
  - 前端需实现静默刷新逻辑
- **验收点**: {{如：Token 过期时自动刷新，无需用户重新登录}}

### BR-011: {{规则名称，如：并发库存冲突}}
- **强制等级**: MUST
- **规则**:
  ```
  IF 两用户同时购买最后一件库存
  THEN 使用乐观锁或 Redis 原子操作
  AND 仅一个用户下单成功
  AND 另一用户收到"库存不足"提示
  ```
- **验收点**: {{如：模拟并发测试通过}}

---

## {{业务领域 3，如：异常处理}}

### BR-020: {{规则名称，如：网络异常处理}}
- **强制等级**: SHOULD
- **规则**:
  - 用户提交表单时断网 → 缓存请求
  - 网络恢复后自动重试或提示手动重试

### BR-021: {{规则名称，如：服务端错误展示}}
- **强制等级**: MUST
- **规则**:
  - 5xx 错误展示友好插画，禁止展示代码堆栈
  - 提供"刷新"按钮

---

## AI 引用指南

当 AI 生成业务逻辑代码时：
1. 首先查找对应的 BR-XXX 规则
2. 严格按照规则中的 IF-THEN 逻辑实现
3. 对于 MUST 级别规则，必须添加验证逻辑
4. 对于 SHOULD 级别规则，添加降级处理
