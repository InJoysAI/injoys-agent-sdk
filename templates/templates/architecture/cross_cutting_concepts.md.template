# è·¨åˆ‡é¢æ¦‚å¿µæ¨¡æ¿ (Cross-cutting Concepts Template)

> **Metadata**
> - **Source**: `{{æ¶æ„è®¾è®¡æ–‡æ¡£è·¯å¾„}}`
> - **Generated At**: `{{ç”Ÿæˆæ—¶é—´ YYYY-MM-DD HH:mm}}`
> - **Generator**: `Context-Agent v1.0`

---

## ğŸ“Š å¯è§‚æµ‹æ€§ (Observability)

### æ—¥å¿—è§„èŒƒ

**ç»“æ„åŒ–æ—¥å¿—æ ¼å¼ (JSON)**:
```json
{
  "timestamp": "2024-01-15T10:30:00Z",
  "level": "INFO",
  "service": "user-service",
  "trace_id": "abc123",
  "span_id": "def456",
  "message": "User created",
  "user_id": "user-789",
  "duration_ms": 45
}
```

**æ—¥å¿—çº§åˆ«ä½¿ç”¨**:
| çº§åˆ« | åœºæ™¯ |
|------|------|
| ERROR | éœ€è¦ç«‹å³å¤„ç†çš„é”™è¯¯ |
| WARN | æ½œåœ¨é—®é¢˜ï¼Œä¸å½±å“æ ¸å¿ƒæµç¨‹ |
| INFO | ä¸šåŠ¡å…³é”®äº‹ä»¶ |
| DEBUG | è°ƒè¯•ä¿¡æ¯ï¼ˆç”Ÿäº§ç¯å¢ƒé»˜è®¤å…³é—­ï¼‰ |

### æŒ‡æ ‡ç›‘æ§ (RED Method)

| ç±»å‹ | æŒ‡æ ‡å | æè¿° |
|------|--------|------|
| **Rate** | `http_requests_total` | è¯·æ±‚é€Ÿç‡ |
| **Errors** | `http_requests_errors_total` | é”™è¯¯æ•°é‡ |
| **Duration** | `http_request_duration_seconds` | è¯·æ±‚è€—æ—¶ |

### åˆ†å¸ƒå¼è¿½è¸ª

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| **åè®®** | OpenTelemetry (OTLP) |
| **é‡‡æ ·ç‡** | ç”Ÿäº§ç¯å¢ƒ 10%ï¼Œé”™è¯¯ 100% |
| **å­˜å‚¨** | Jaeger / Tempo |

---

## âŒ é”™è¯¯å¤„ç† (Error Handling)

### ç»Ÿä¸€é”™è¯¯ç»“æ„

```go
type AppError struct {
    Code    string `json:"code"`
    Message string `json:"message"`
    Details any    `json:"details,omitempty"`
    TraceID string `json:"trace_id"`
}
```

### é‡è¯•ç­–ç•¥

| åœºæ™¯ | ç­–ç•¥ | å‚æ•° |
|------|------|------|
| HTTP è°ƒç”¨ | æŒ‡æ•°é€€é¿ | åˆå§‹ 100msï¼Œæœ€å¤§ 3 æ¬¡ |
| æ•°æ®åº“è¿æ¥ | å›ºå®šé—´éš” | 1sï¼Œæœ€å¤§ 5 æ¬¡ |
| æ¶ˆæ¯æ¶ˆè´¹ | æŒ‡æ•°é€€é¿ | åˆå§‹ 1sï¼Œæœ€å¤§ 5 æ¬¡ |

### ç†”æ–­å™¨é…ç½®

| å‚æ•° | å€¼ |
|------|-----|
| å¤±è´¥é˜ˆå€¼ | 50% (10 æ¬¡è¯·æ±‚ä¸­ 5 æ¬¡å¤±è´¥) |
| ç†”æ–­æ—¶é—´ | 30 ç§’ |
| åŠå¼€è¯·æ±‚æ•° | 3 |

---

## ğŸ’¾ ç¼“å­˜ç­–ç•¥ (Caching)

| ç¼“å­˜ç±»å‹ | åœºæ™¯ | TTL | å¤±æ•ˆç­–ç•¥ |
|---------|------|-----|---------|
| **æœ¬åœ°ç¼“å­˜** | é…ç½®ã€å­—å…¸æ•°æ® | 5 min | å®šæ—¶åˆ·æ–° |
| **åˆ†å¸ƒå¼ç¼“å­˜** | ç”¨æˆ·ä¼šè¯ã€çƒ­ç‚¹æ•°æ® | 30 min | LRU æ·˜æ±° |
| **CDN ç¼“å­˜** | é™æ€èµ„æº | 1 day | ç‰ˆæœ¬å·å¤±æ•ˆ |

### ç¼“å­˜ç©¿é€/å‡»ç©¿/é›ªå´©é˜²æŠ¤

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| ç©¿é€ | å¸ƒéš†è¿‡æ»¤å™¨ + ç©ºå€¼ç¼“å­˜ |
| å‡»ç©¿ | äº’æ–¥é” + çƒ­ç‚¹é¢„åŠ è½½ |
| é›ªå´© | TTL éšæœºåŒ– + å¤šçº§ç¼“å­˜ |

---

## ğŸ”„ äº‹åŠ¡æ¨¡å¼ (Transaction Patterns)

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | å®ç° |
|------|---------|------|
| **æœ¬åœ°äº‹åŠ¡** | å•åº“æ“ä½œ | æ•°æ®åº“äº‹åŠ¡ |
| **Saga** | è·¨æœåŠ¡é•¿äº‹åŠ¡ | ç¼–æ’å¼ Saga |
| **Outbox** | æ¶ˆæ¯å¯é å‘é€ | äº‹åŠ¡æ€§ Outbox è¡¨ |

---

## ğŸ” é…ç½®ä¸å¯†é’¥ç®¡ç†

| ç±»å‹ | å­˜å‚¨ä½ç½® | æ›´æ–°æ–¹å¼ |
|------|---------|---------|
| åº”ç”¨é…ç½® | é…ç½®ä¸­å¿ƒ (Consul/Nacos) | çƒ­æ›´æ–° |
| æ•æ„Ÿé…ç½® | Vault / KMS | API è·å– |
| ç¯å¢ƒå˜é‡ | K8s ConfigMap/Secret | é‡å¯ç”Ÿæ•ˆ |

---

## ğŸ“¨ äº‹ä»¶è§„èŒƒ (Event Standards)

### äº‹ä»¶å‘½å

```
{domain}.{entity}.{action}
ä¾‹å¦‚ï¼šorder.order.created
```

### äº‹ä»¶ç»“æ„

```json
{
  "event_id": "uuid",
  "event_type": "order.order.created",
  "source": "order-service",
  "timestamp": "2024-01-15T10:30:00Z",
  "data": {
    "order_id": "123",
    "user_id": "456"
  },
  "metadata": {
    "trace_id": "abc",
    "version": "1.0"
  }
}
```
